# Proposal: 添加自动股票购买卖出机制

本提案旨在为 A 股智能分析系统增加一个可选的、可配置的自动交易执行模块。当前系统只进行分析和通知，本功能将使其具备策略回测、模拟交易和实盘交易的全闭环能力。

## 1. 目标

-   **闭环交易**: 基于现有分析结果（如“决策仪表盘”）执行自动化的买入和卖出操作。
-   **策略验证**: 提供一个严格遵循时间序列的回测引擎，用于在历史数据上科学地评估交易策略的稳定性和收益表现。
-   **风险可控**: **所有设计都将以安全为第一原则**。必须包含一个功能完备的**模拟交易 (Paper Trading) 模式**作为默认选项。真实交易必须由用户显式开启，并接受相关风险提示。
-   **高效协作**: 构建一个双层模型协作框架（Agent 架构），使用小模型进行信息摘要，降低大模型的 Token 消耗和决策成本。
-   **高度可配**: 用户可以灵活配置交易逻辑，包括资金上限、交易阈值、单笔订单大小、利润处理方式等。
-   **模块化设计**: 交易功能将作为独立的模块开发，与现有的分析模块低耦合，方便维护和未来的扩展（如接入不同券商）。

## 2. 核心能力 (Capabilities)

为了实现上述目标，我们将分阶段引入以下核心能力：

1.  **`broker-integration` (经纪商集成)**:
    - 定义一套标准的经纪商接口，用于执行下单、查询订单、获取持仓和余额等操作。
    - 实现一个功能完备的**模拟经纪商 (Paper Broker)**，用于在没有真实资金风险的情况下测试和验证整个交易流程。

2.  **`trading-configuration` (交易配置)**:
    - 提供一套新的配置项，允许用户定义其交易偏好。

3.  **`order-execution` (订单执行)**:
    - 创建一个订单执行引擎，它会订阅分析模块的产出，并根据策略执行订单。

4.  **`backtesting-engine` (回测引擎) - [新]**:
    - 创建一个回测控制器，可以按时间顺序（如按天）迭代历史行情数据。
    - 在每个时间点，只将该时刻及之前的数据提供给分析和交易引擎，以模拟真实决策环境，杜绝“未来函数”。
    - 运行结束后，生成策略表现报告（如总回报率、夏普比率、最大回撤等）。

5.  **`two-tier-llm-architecture` (双层LLM架构) - [新]**:
    - 构建一个 Agent 化的工作流。
    - **摘要 Agent (Summarizer Agent)**: 使用一个轻量级模型（本地或云端小模型），负责对新闻、公告等非结构化信息进行预处理和摘要。
    - **决策 Agent (Decision Agent)**: 使用核心的大模型，接收来自“摘要 Agent”的结构化信息和行情数据，专注于做出最终的买入/卖出决策。

6.  **`short-selling-support` (做空支持)**:
    - (可选/未来) 探索和实现做空交易的可能性。

## 3. 关键考量

-   **安全性**: 真实交易的 API Key 和 Secret 将作为最高级别的敏感信息处理。
-   **数据可用性**: 历史回测的有效性高度依赖于历史数据的质量和完整性。特别是历史新闻数据，获取难度较大，初期回测可能主要依赖量价数据。
-   **免责声明**: 必须在文档和 UI 中增加清晰的免责声明，告知用户自动交易所涉及的金融风险。