# 配置准备清单

本文档汇总运行「A股智能分析系统」前需要准备的配置项，并说明每一项的作用。配置可通过项目根目录下的 `.env` 文件填写，或在使用 GitHub Actions 时在仓库 Secrets 中填写（变量名一致）。

---

## 一、必填配置

| 配置项 | 环境变量名 | 作用 |
|--------|------------|------|
| **自选股列表** | `STOCK_LIST` | 要分析的股票代码，多个用英文逗号分隔。例如：`600519,300750,002594`。A 股 6 位数字，港股加前缀如 `hk00700`。系统会按此列表拉取行情并做 AI 分析。 |

---

## 二、AI 分析（必填其一）

系统用大模型生成「买入/观望/卖出」建议和决策摘要，以下二选一或都配（优先用 Gemini）。

| 配置项 | 环境变量名 | 作用 |
|--------|------------|------|
| **Gemini API Key** | `GEMINI_API_KEY` | Google AI Studio 提供的 API Key，用于调用 Gemini 做分析。免费额度见 [Google AI Studio](https://aistudio.google.com/)。 |
| **Gemini 主模型** | `GEMINI_MODEL` | 使用的模型名称，默认 `gemini-3-flash-preview`。可按需改为如 `gemini-2.5-flash`。 |
| **OpenAI 兼容 API Key** | `OPENAI_API_KEY` | 当未配置或不用 Gemini 时，用此 Key 调用 OpenAI 兼容接口（DeepSeek、通义千问、Moonshot 等）。 |
| **OpenAI 兼容 API 地址** | `OPENAI_BASE_URL` | 兼容接口的 base URL，例如 DeepSeek：`https://api.deepseek.com/v1`。不填则用 OpenAI 官方地址。 |
| **OpenAI 兼容模型名** | `OPENAI_MODEL` | 模型名称，如 `deepseek-chat`、`gpt-4o-mini`。默认 `gpt-4o-mini`。 |

**说明**：`GEMINI_API_KEY` 与 `OPENAI_API_KEY` 至少配置一个，AI 分析功能才可用。

---

## 三、通知推送（可选，建议至少一种）

分析结果与大盘复盘可推送到以下渠道；不配置则只写本地日志、不推送。

| 配置项 | 环境变量名 | 作用 |
|--------|------------|------|
| **企业微信 Webhook** | `WECHAT_WEBHOOK_URL` | 企业微信群机器人的 Webhook 地址，分析报告会推送到该群。 |
| **飞书 Webhook** | `FEISHU_WEBHOOK_URL` | 飞书群机器人的 Webhook 地址，用于接收报告。 |
| **Telegram Bot Token** | `TELEGRAM_BOT_TOKEN` | 在 @BotFather 创建的 Bot Token，需与 `TELEGRAM_CHAT_ID` 一起配置。 |
| **Telegram Chat ID** | `TELEGRAM_CHAT_ID` | 接收消息的会话 ID，与上面 Token 配合使用。 |
| **发件人邮箱** | `EMAIL_SENDER` | 发信邮箱地址（如 `xxx@qq.com`），需与 `EMAIL_PASSWORD` 一起配置。 |
| **邮箱授权码** | `EMAIL_PASSWORD` | 邮箱 SMTP 授权码（非登录密码），用于发送邮件。 |
| **收件人列表** | `EMAIL_RECEIVERS` | 收件人邮箱，多个用逗号分隔；留空则发到发件人自己。 |
| **Pushover 用户 Key** | `PUSHOVER_USER_KEY` | Pushover 用户 Key，用于手机/桌面推送，需与 `PUSHOVER_API_TOKEN` 一起配置。 |
| **Pushover API Token** | `PUSHOVER_API_TOKEN` | 在 pushover.net 创建应用后获得的 API Token。 |
| **自定义 Webhook 地址** | `CUSTOM_WEBHOOK_URLS` | 自定义 HTTP Webhook，多个用逗号分隔；支持钉钉、Discord、Slack 等可接收 POST JSON 的服务。 |
| **自定义 Webhook Bearer Token** | `CUSTOM_WEBHOOK_BEARER_TOKEN` | 若自定义 Webhook 需要鉴权，可填 Bearer Token。 |
| **单股推送模式** | `SINGLE_STOCK_NOTIFY` | 设为 `true` 时，每分析完一只股票就推送一次；否则全部分析完后汇总推送一次。 |

---

## 四、新闻/舆情搜索（可选，建议至少一种）

用于拉取与股票相关的新闻和舆情，丰富 AI 分析上下文与 Web 控制台「实时新闻」；不配置则无新闻维度。

| 配置项 | 环境变量名 | 作用 |
|--------|------------|------|
| **Tavily API Keys** | `TAVILY_API_KEYS` | [Tavily](https://tavily.com/) 搜索 API 的 Key，多个用逗号分隔可做简单负载。 |
| **博查 API Keys** | `BOCHA_API_KEYS` | [博查搜索](https://open.bocha.cn/) 的 Key，中文搜索与摘要效果较好，多个用逗号分隔。 |
| **SerpAPI Keys** | `SERPAPI_API_KEYS` | [SerpAPI](https://serpapi.com/) 的 Key，作为备用搜索源，多个用逗号分隔。 |

### 新闻搜索 API 获取与认证途径

任选其一或多种配置即可启用实时新闻（推荐优先 **Tavily** 或 **博查**，中文股票新闻更友好）。

- **Tavily**
  - 官网：<https://tavily.com/>
  - 获取方式：注册账号 → 进入 [API](https://app.tavily.com/) 或 Dashboard → 创建/复制 API Key。
  - 认证：在 `.env` 中设置 `TAVILY_API_KEYS=你的Key`（多个用英文逗号分隔）。
  - 免费额度：每月约 1000 次请求，适合个人与小规模使用。

- **博查（Bocha）**
  - 官网：<https://open.bocha.cn/>
  - 获取方式：注册开放平台账号 → 创建应用 → 在应用详情中获取 API Key。
  - 认证：在 `.env` 中设置 `BOCHA_API_KEYS=你的Key`（多个用英文逗号分隔）。
  - 特点：针对中文与国内资讯优化，适合 A 股相关新闻。

- **SerpAPI**
  - 官网：<https://serpapi.com/>
  - 获取方式：注册 → [Dashboard](https://serpapi.com/manage-api-key) 中查看或创建 API Key。
  - 认证：在 `.env` 中设置 `SERPAPI_API_KEYS=你的Key`（多个用英文逗号分隔）。
  - 说明：可搜索 Google 等引擎结果，免费额度有限，多作备用。

---

## 五、行情数据（可选）

| 配置项 | 环境变量名 | 作用 |
|--------|------------|------|
| **Tushare Token** | `TUSHARE_TOKEN` | [Tushare Pro](https://tushare.pro/) 的 Token；不配则使用 AkShare 等免费数据源。 |

系统默认已支持 AkShare（免费），仅在需要更稳定或更全的数据时可配置 Tushare。

---

## 六、飞书云文档（可选）

| 配置项 | 环境变量名 | 作用 |
|--------|------------|------|
| **飞书应用 ID** | `FEISHU_APP_ID` | 飞书开放平台应用的 App ID，用于创建/写入云文档。 |
| **飞书应用 Secret** | `FEISHU_APP_SECRET` | 对应应用的 App Secret。 |
| **飞书文件夹 Token** | `FEISHU_FOLDER_TOKEN` | 要存放日报的飞书云文档文件夹的 Token。 |

配置后，系统可将每日复盘与决策仪表盘写入飞书云文档。

---

## 七、运行与系统（可选）

| 配置项 | 环境变量名 | 默认值 | 作用 |
|--------|------------|--------|------|
| **数据库路径** | `DATABASE_PATH` | `./data/stock_analysis.db` | SQLite 数据库文件路径，存行情与分析记录。 |
| **日志目录** | `LOG_DIR` | `./logs` | 日志文件所在目录。 |
| **日志级别** | `LOG_LEVEL` | `INFO` | 日志级别：DEBUG / INFO / WARNING / ERROR / CRITICAL。 |
| **最大并发数** | `MAX_WORKERS` | `3` | 分析时的并发线程数，不宜过大以免触发数据源限流。 |
| **调试模式** | `DEBUG` | `false` | 设为 `true` 开启调试日志。 |
| **定时任务开关** | `SCHEDULE_ENABLED` | `false` | 设为 `true` 时启用内置定时任务。 |
| **每日执行时间** | `SCHEDULE_TIME` | `18:00` | 定时任务每日运行时间（HH:MM，24 小时制）。 |
| **是否大盘复盘** | `MARKET_REVIEW_ENABLED` | `true` | 是否在每日分析中执行大盘复盘。 |
| **WebUI 开关** | `WEBUI_ENABLED` | `false` | 是否在启动时一并启动 Web 控制台。 |
| **WebUI 监听地址** | `WEBUI_HOST` | `127.0.0.1` | WebUI 绑定的主机地址。 |
| **WebUI 端口** | `WEBUI_PORT` | `8000` | WebUI 监听端口。 |

---

## 八、交易与回测（可选）

| 配置项 | 环境变量名 | 默认值 | 作用 |
|--------|------------|--------|------|
| **交易模式** | `TRADING_MODE` | `paper` | `paper` 模拟盘，`live` 实盘。实盘需再配置下方券商相关项。 |
| **初始资金** | `TRADING_CAPITAL` | `100000.0` | 模拟盘或回测的初始资金（元）。 |
| **单股最大持仓金额** | `TRADING_MAX_POSITION_PER_STOCK` | `20000.0` | 单只股票最大持仓金额，用于风控。 |
| **经纪商类型** | `TRADING_BROKER` | `paper` | 实盘时：`real_api` 量化接口，`real_ui_automation` 模拟人工操作。 |
| **券商类型标识** | `REAL_BROKER_TYPE` | - | 实盘券商标识，如 `tiger`（老虎）、`ths_web`（同花顺网页）等。 |
| **实盘 API Key** | `REAL_BROKER_API_KEY` | - | 使用量化接口（real_api）时的 API Key。 |
| **实盘 API Secret** | `REAL_BROKER_API_SECRET` | - | 使用量化接口时的 Secret 或 RSA 私钥路径/内容。 |
| **实盘交易账号** | `REAL_BROKER_ACCOUNT` | - | 使用 UI 自动化时的交易账号。 |
| **实盘交易密码** | `REAL_BROKER_PASSWORD` | - | 使用 UI 自动化时的交易密码（敏感，注意保管）。 |
| **UI 自动化浏览器** | `UI_AUTOMATION_BROWSER` | `chrome` | 可选：`chrome` / `firefox` / `edge`。 |
| **UI 无头模式** | `UI_AUTOMATION_HEADLESS` | `true` | 是否无头模式运行浏览器。 |

实盘与 UI 自动化存在合规与资金风险，请自行评估后使用。

---

## 九、最小可运行配置示例

仅需「能跑起来并做一次分析」时，在 `.env` 中至少配置：

```env
# 必填：要分析的股票
STOCK_LIST=600519,300750

# AI 分析（二选一）
GEMINI_API_KEY=你的_Gemini_API_Key
# 或使用 OpenAI 兼容 API：
# OPENAI_API_KEY=你的_Key
# OPENAI_BASE_URL=https://api.deepseek.com/v1
# OPENAI_MODEL=deepseek-chat
```

不配置通知与搜索时，分析结果只会写入本地数据库和日志；配置方式见上文对应章节。

更多环境变量细节与高级用法见 [配置指南](config-guide.md)。
